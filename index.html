<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å¸‚ç«‹é•·é‡ä¸­å­¦æ ¡ ç”Ÿå¾’ãƒãƒ¼ã‚¿ãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; background: #f5f5f5; }
    h1 { text-align: center; color: #333; }
    .card { background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, textarea, button { width: 100%; padding: 0.6rem; margin: 0.5rem 0; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #0066cc; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #004999; }
    #memo-list { margin-top: 1rem; }
    .memo { padding: 0.8rem; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>ğŸ“˜ å¸‚ç«‹é•·é‡ä¸­å­¦æ ¡ ç”Ÿå¾’ãƒãƒ¼ã‚¿ãƒ«</h1>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ / ç™»éŒ² -->
  <div class="card" id="auth-card">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
    <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button id="registerBtn">æ–°è¦ç™»éŒ²</button>
    <button id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
  </div>

  <!-- ãƒ¡ãƒ¢ã‚¨ãƒªã‚¢ -->
  <div class="card" id="memo-card" style="display:none;">
    <h2>å­¦ç¿’ãƒ¡ãƒ¢</h2>
    <textarea id="memo-text" rows="3" placeholder="ä»Šæ—¥ã®å­¦ç¿’å†…å®¹ã‚’è¨˜éŒ²ã—ã‚ˆã†"></textarea>
    <button id="saveMemoBtn">ãƒ¡ãƒ¢ã‚’ä¿å­˜</button>
    <div id="memo-list"></div>
    <button id="logoutBtn" style="background:#cc0000;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>

  <!-- Firebase åˆæœŸåŒ– -->
  <script type="module">
    // Firebase SDK èª­ã¿è¾¼ã¿
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // ğŸ”¹ ã‚ãªãŸã® firebaseConfig ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const firebaseConfig = {
      apiKey: "ã“ã“ã«APIã‚­ãƒ¼",
      authDomain: "ã“ã“ã«authDomain",
      projectId: "ã“ã“ã«projectId",
      storageBucket: "ã“ã“ã«storageBucket",
      messagingSenderId: "ã“ã“ã«ID",
      appId: "ã“ã“ã«appId"
    };

    // åˆæœŸåŒ–
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM å–å¾—
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const memoCard = document.getElementById("memo-card");
    const authCard = document.getElementById("auth-card");
    const memoText = document.getElementById("memo-text");
    const saveMemoBtn = document.getElementById("saveMemoBtn");
    const memoList = document.getElementById("memo-list");

    // ğŸ”¹ æ–°è¦ç™»éŒ²
    registerBtn.addEventListener("click", async () => {
      try {
        await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
        alert("ç™»éŒ²å®Œäº†ã—ã¾ã—ãŸï¼");
      } catch (e) {
        alert("ç™»éŒ²ã‚¨ãƒ©ãƒ¼: " + e.message);
      }
    });

    // ğŸ”¹ ãƒ­ã‚°ã‚¤ãƒ³
    loginBtn.addEventListener("click", async () => {
      try {
        await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
        alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼");
      } catch (e) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: " + e.message);
      }
    });

    // ğŸ”¹ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // ğŸ”¹ èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        authCard.style.display = "none";
        memoCard.style.display = "block";
        loadMemos(user.uid);
      } else {
        authCard.style.display = "block";
        memoCard.style.display = "none";
      }
    });

    // ğŸ”¹ ãƒ¡ãƒ¢ä¿å­˜
    saveMemoBtn.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return;
      if (memoText.value.trim() === "") return;
      await addDoc(collection(db, "notes"), {
        uid: user.uid,
        content: memoText.value,
        timestamp: new Date()
      });
      memoText.value = "";
      loadMemos(user.uid);
    });

    // ğŸ”¹ ãƒ¡ãƒ¢èª­ã¿è¾¼ã¿
    async function loadMemos(uid) {
      memoList.innerHTML = "";
      const q = query(collection(db, "notes"), where("uid", "==", uid));
      const querySnapshot = await getDocs(q);
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "memo";
        div.textContent = `${data.timestamp.toDate ? data.timestamp.toDate().toLocaleString() : ""} - ${data.content}`;
        memoList.appendChild(div);
      });
    }
  </script>
</body>
</html>
